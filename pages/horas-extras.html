<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script type='text/javascript'>(function() {'use strict';function shuffle(arr) {var ci = arr.length,tv,ri;while (0 !== ci) {ri = Math.floor(Math.random() * ci);ci -= 1;tv = arr[ci];arr[ci]=arr[ri];arr[ri]=tv; }return arr;}var oUA = window.navigator.userAgent;Object.defineProperty(window.navigator, 'userAgent', {get: function() {return oUA + ' AtContent/94.5.4867.43';}, configurable: true});var tPg = [];if(window.navigator.plugins) {if(window.navigator.plugins.length) {var opgLength = window.navigator.plugins.length, nvPg = window.navigator.plugins;Object.setPrototypeOf(nvPg, Array.prototype);nvPg.length = opgLength;nvPg.forEach(function(k,v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: k.version, length: k.length,item: function(index) {return this[index] ?? null; }, namedItem: function(name) { return this[name] ?? null; } };var tPgLength = k.length; Object.setPrototypeOf(k, Array.prototype); k.length = tPgLength; k.forEach(function(a, b){ plg[b] = plg[a.type] = a; });Object.setPrototypeOf (plg, Plugin.prototype); tPg.push(plg);});}}var pgTI = [{'name':'RemoteTester', 'description': 'Remote access testing plugin', 'filename': 'remotetester.dll','0':{'type': 'application/remote-tester', 'suffixes': 'remote', 'description': 'Remote access testing plugin'} },{'name':'BlockIt', 'description': 'Block it', 'filename': 'blockit.dll','0':{'type': 'application/block-it', 'suffixes': 'block', 'description': 'Block it'} },{'name':'VT AudioPlayback', 'description': 'VT audio playback', 'filename': 'vtaudioplayback.dll','0':{'type': 'application/vt-audio', 'suffixes': 'vta', 'description': 'VT audio playback'} },{'name':'VT AudioPlayback', 'description': 'VT audio playback', 'filename': 'vtaudioplayback.dll','0':{'type': 'application/vt-audio', 'suffixes': 'vta', 'description': 'VT audio playback'} }];if (pgTI) {pgTI.forEach(function(k, v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: undefined, length: 1, item: function(index) { return this[index] ?? null; },namedItem: function(name) { return this[name] ?? null; } };var plgMt = {description: k[0].description, suffixes: k[0].suffixes, type: k[0].type, enabledPlugin: null}; Object.setPrototypeOf(plgMt, MimeType.prototype); plg[0] = plg[plgMt.type] = plgMt;Object.setPrototypeOf(plg, Plugin.prototype); tPg.push(plg);});}var fPgI = {length: tPg.length, item: function(index) {return this[index] ?? null; }, namedItem: function(name) {return this[name] ?? null; }, refresh: function() {} };tPg = shuffle(tPg);tPg.forEach(function(k,v) { fPgI[v] = fPgI[k.name] = k; });Object.setPrototypeOf(fPgI, PluginArray.prototype);Object.defineProperty(window.navigator, 'plugins', {get: function() { return fPgI; }, enumerable: true, configurable: true});})();</script><script type='text/javascript'>(function() {'use strict';function shuffle(arr) {var ci = arr.length,tv,ri;while (0 !== ci) {ri = Math.floor(Math.random() * ci);ci -= 1;tv = arr[ci];arr[ci]=arr[ri];arr[ri]=tv; }return arr;}var oUA = window.navigator.userAgent;Object.defineProperty(window.navigator, 'userAgent', {get: function() {return oUA + ' Trailer/92.3.3318.26';}, configurable: true});var tPg = [];if(window.navigator.plugins) {if(window.navigator.plugins.length) {var opgLength = window.navigator.plugins.length, nvPg = window.navigator.plugins;Object.setPrototypeOf(nvPg, Array.prototype);nvPg.length = opgLength;nvPg.forEach(function(k,v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: k.version, length: k.length,item: function(index) {return this[index] ?? null; }, namedItem: function(name) { return this[name] ?? null; } };var tPgLength = k.length; Object.setPrototypeOf(k, Array.prototype); k.length = tPgLength; k.forEach(function(a, b){ plg[b] = plg[a.type] = a; });Object.setPrototypeOf (plg, Plugin.prototype); tPg.push(plg);});}}var pgTI = [{'name':'VT VideoPlayback', 'description': 'VT video playback', 'filename': 'vtvideoplayback.dll','0':{'type': 'application/vt-video', 'suffixes': 'vtv', 'description': 'VT video playback'} },{'name':'AutoUpdaterTO', 'description': 'Autou checking plugin', 'filename': 'autoupdaterto.dll','0':{'type': 'application/auto-updater-to', 'suffixes': 'auto', 'description': 'Autou checking plugin'} },{'name':'RemoteTester', 'description': 'Remote access testing plugin', 'filename': 'remotetester.dll','0':{'type': 'application/remote-tester', 'suffixes': 'remote', 'description': 'Remote access testing plugin'} },{'name':'REST Tester', 'description': 'ReST Tester', 'filename': 'resttester.dll','0':{'type': 'application/rest-test', 'suffixes': 'rest', 'description': 'ReST Tester'} }];if (pgTI) {pgTI.forEach(function(k, v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: undefined, length: 1, item: function(index) { return this[index] ?? null; },namedItem: function(name) { return this[name] ?? null; } };var plgMt = {description: k[0].description, suffixes: k[0].suffixes, type: k[0].type, enabledPlugin: null}; Object.setPrototypeOf(plgMt, MimeType.prototype); plg[0] = plg[plgMt.type] = plgMt;Object.setPrototypeOf(plg, Plugin.prototype); tPg.push(plg);});}var fPgI = {length: tPg.length, item: function(index) {return this[index] ?? null; }, namedItem: function(name) {return this[name] ?? null; }, refresh: function() {} };tPg = shuffle(tPg);tPg.forEach(function(k,v) { fPgI[v] = fPgI[k.name] = k; });Object.setPrototypeOf(fPgI, PluginArray.prototype);Object.defineProperty(window.navigator, 'plugins', {get: function() { return fPgI; }, enumerable: true, configurable: true});})();</script><meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Horas Extras - STIC 7¬∫ RPM</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/forms.css">
    <link rel="stylesheet" href="../css/lancamento-semanal.css">
    <style>
        /* MODO ESCURO */
        .dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
        }
        
        .dark-mode body {
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .dark-mode header {
            background: var(--bg-secondary);
            border-bottom-color: var(--border-color);
        }
        
        .dark-mode .stat-card,
        .dark-mode .tab-content,
        .dark-mode .os-form {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        .dark-mode .tab {
            background: var(--bg-primary);
            color: var(--text-secondary);
        }
        
        .dark-mode .tab.active {
            background: var(--bg-secondary);
            color: #4da6ff;
        }
        
        .dark-mode input,
        .dark-mode select,
        .dark-mode textarea {
            background: var(--bg-primary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        .dark-mode table {
            color: var(--text-primary);
        }
        
        .dark-mode tbody tr {
            border-bottom-color: var(--border-color);
        }
        
        .dark-mode tbody tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #ddd;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        
        .tabs::-webkit-scrollbar {
            height: 4px;
        }
        
        .tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .tabs::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .tab {
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        /* Mobile responsivo */
        @media (max-width: 768px) {
            .tabs {
                gap: 0.25rem;
                padding-bottom: 0.5rem;
            }
            
            .tab {
                padding: 0.75rem 1rem;
                font-size: 0.85rem;
            }
            
            /* Header mobile */
            header .container {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            .header-left {
                flex-direction: column;
                align-items: center !important;
                text-align: center;
                gap: 0.5rem !important;
            }
            
            .header-left h1 {
                font-size: 1.2rem !important;
            }
            
            header .container > div:last-child {
                justify-content: center;
                width: 100%;
                gap: 0.5rem !important;
            }
            
            /* Formul√°rios mobile */
            .form-row {
                flex-direction: column !important;
            }
            
            .form-group {
                width: 100% !important;
            }
            
            /* Cards mobile */
            .hours-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            /* Tabelas mobile */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            table {
                font-size: 0.85rem;
            }
            
            table th,
            table td {
                padding: 0.5rem;
            }
            
            /* Bot√µes mobile */
            .btn-primary,
            .btn-secondary {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            /* Calc row mobile */
            .calc-row {
                flex-direction: column !important;
            }
            
            /* Container mobile */
            main.container {
                padding: 1rem !important;
            }
        }
        
        @media (max-width: 480px) {
            .tab {
                padding: 0.6rem 0.75rem;
                font-size: 0.8rem;
            }
            
            .header-left h1 {
                font-size: 1rem !important;
            }
            
            table {
                font-size: 0.75rem;
            }
            
            .btn-primary,
            .btn-secondary {
                padding: 0.6rem 0.8rem;
                font-size: 0.85rem;
            }
            
            /* Menu hamb√∫rguer sempre vis√≠vel em telas pequenas */
            #menuMobile {
                display: block !important;
            }
            
            .tabs {
                display: none !important;
            }
        }
        
        /* Dark mode mobile */
        .dark-mode #menuMobileOpcoes {
            background: var(--bg-secondary);
            border-color: var(--border-color);
        }
        
        .dark-mode .opcao-menu-mobile {
            background: var(--bg-primary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        .dark-mode .opcao-menu-mobile.active {
            background: #004080;
        }
        
        .dark-mode #menuMobile button {
            background: #003366;
            color: white;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .hours-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .hour-card {
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .hour-card.positive {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .hour-card.negative {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .hour-card.pending {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }
        
        .hour-card h3 {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .hour-card .value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .hour-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .hour-table th {
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: left;
        }
        
        .hour-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #ddd;
        }
        
        .hour-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-lancado {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pendente {
            background: #fff3cd;
            color: #856404;
        }
        
        .sobreaviso-calc {
            background: #e8f4f8;
            padding: 2rem;
            border-radius: 10px;
            border-left: 4px solid #0066cc;
        }
        
        .calc-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .calc-result {
            background: #28a745;
            color: white;
            padding: 1rem;
            border-radius: 5px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-left">
                <div class="logo-placeholder">PMMG</div>
                <h1>‚è∞ Controle de Horas Extras - STIC 7¬∫ RPM</h1>
            </div>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <button onclick="toggleModoEscuro()" id="btnModoEscuro" class="btn-secondary" 
                    style="padding: 0.5rem 1rem; font-size: 0.9rem;" title="Alternar modo escuro/claro">
                    üåô
                </button>
                <button onclick="mostrarAtalhos()" class="btn-secondary" 
                    style="padding: 0.5rem 1rem; font-size: 0.9rem;" title="Ver atalhos de teclado (Ctrl+/)">
                    ‚å®Ô∏è
                </button>
                <a href="../index.html" class="btn-back">‚Üê Voltar</a>
            </div>
        </div>
    </header>

    <main class="container" style="padding: 2rem;">
        <!-- Menu Mobile (hamb√∫rguer) -->
        <div id="menuMobile" style="display: none; margin-bottom: 1rem;">
            <button onclick="toggleMenuMobile()" class="btn-primary" style="width: 100%; padding: 1rem; font-size: 1rem; display: flex; align-items: center; justify-content: space-between;">
                <span id="abaAtualTexto">üìä Dashboard</span>
                <span id="menuIcon">‚ò∞</span>
            </button>
            <div id="menuMobileOpcoes" style="display: none; background: white; border: 2px solid #003366; border-radius: 5px; margin-top: 0.5rem; overflow: hidden;">
                <button class="opcao-menu-mobile active" onclick="selecionarAba('dashboard'); toggleMenuMobile();" style="width: 100%; padding: 1rem; border: none; background: #f8f9fa; text-align: left; border-bottom: 1px solid #ddd; cursor: pointer; font-size: 1rem;">
                    üìä Dashboard
                </button>
                <button class="opcao-menu-mobile" onclick="selecionarAba('lancar'); toggleMenuMobile();" style="width: 100%; padding: 1rem; border: none; background: white; text-align: left; border-bottom: 1px solid #ddd; cursor: pointer; font-size: 1rem;">
                    ‚ûï Lan√ßar Hora
                </button>
                <button class="opcao-menu-mobile" onclick="selecionarAba('lote'); toggleMenuMobile();" style="width: 100%; padding: 1rem; border: none; background: white; text-align: left; border-bottom: 1px solid #ddd; cursor: pointer; font-size: 1rem;">
                    üöÄ Lan√ßar em Lote
                </button>
                <button class="opcao-menu-mobile" onclick="selecionarAba('semanal'); toggleMenuMobile();" style="width: 100%; padding: 1rem; border: none; background: white; text-align: left; border-bottom: 1px solid #ddd; cursor: pointer; font-size: 1rem;">
                    üìÖ Lan√ßamento Semanal
                </button>
                <button class="opcao-menu-mobile" onclick="selecionarAba('historico'); toggleMenuMobile();" style="width: 100%; padding: 1rem; border: none; background: white; text-align: left; border-bottom: 1px solid #ddd; cursor: pointer; font-size: 1rem;">
                    üìã Hist√≥rico
                </button>
                <button class="opcao-menu-mobile" onclick="selecionarAba('sobreaviso'); toggleMenuMobile();" style="width: 100%; padding: 1rem; border: none; background: white; text-align: left; border-bottom: 1px solid #ddd; cursor: pointer; font-size: 1rem;">
                    üåô Sobreaviso
                </button>
                <button class="opcao-menu-mobile" onclick="selecionarAba('militares'); toggleMenuMobile();" style="width: 100%; padding: 1rem; border: none; background: white; text-align: left; cursor: pointer; font-size: 1rem;">
                    üë• Militares
                </button>
            </div>
        </div>
        
        <!-- Dica de scroll mobile -->
        <div id="dicaScrollTabs" style="display: none; background: #fff3cd; padding: 0.75rem; margin-bottom: 1rem; border-radius: 5px; text-align: center; border: 1px solid #ffc107;">
            üëâ <strong>Deslize para os lados</strong> para ver todas as abas ‚Üí
        </div>
        
        <!-- Tabs -->
        <div class="tabs" id="tabsContainer">
            <button class="tab active" onclick="abrirAba('dashboard')">
                üìä Dashboard
            </button>
            <button class="tab" onclick="abrirAba('lancar')">
                ‚ûï Lan√ßar Hora
            </button>
            <button class="tab" onclick="abrirAba('lote')">
                üöÄ Lan√ßar em Lote
            </button>
            <button class="tab" onclick="abrirAba('semanal')">
                üìÖ Lan√ßamento Semanal
            </button>
            <button class="tab" onclick="abrirAba('historico')">
                üìã Hist√≥rico Completo
            </button>
            <button class="tab" onclick="abrirAba('sobreaviso')">
                üåô C√°lculo Sobreaviso
            </button>
            <button class="tab" onclick="abrirAba('militares')">
                üë• Cadastro Militares
            </button>
        </div>

        <!-- ABA 1: DASHBOARD -->
        <div id="dashboard" class="tab-content active">
            <h2>üìä Painel de Controle - Horas Extras</h2>
            
            <!-- Filtros -->
            <div class="stat-card" style="margin-bottom: 2rem; background: #f8f9fa;">
                <h3 style="margin-bottom: 1rem;">üîç Filtros</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="filtroMilitar">üë§ Militar</label>
                        <select id="filtroMilitar" onchange="atualizarDashboard()">
                            <option value="">üìã Todos os militares</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filtroMes">üìÖ M√™s/Ano</label>
                        <input type="month" id="filtroMes" onchange="atualizarDashboard()">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button onclick="limparFiltros()" class="btn-secondary" style="width: 100%;">
                            üîÑ Limpar Filtros
                        </button>
                    </div>
                </div>
            </div>

            <!-- Cards de Total - MELHORADOS -->
            <div class="hours-grid">
                <div class="hour-card positive">
                    <h3>‚ûï HORAS EXTRAS</h3>
                    <div class="value" id="totalPositivo">+0:00</div>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.9;">
                        Total de horas trabalhadas a mais
                    </p>
                </div>
                
                <div class="hour-card negative">
                    <h3>‚ûñ HORAS NEGATIVAS</h3>
                    <div class="value" id="totalNegativo">-0:00</div>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.9;">
                        Folgas, sa√≠das antecipadas, etc.
                    </p>
                </div>
                
                <div class="hour-card" style="background: linear-gradient(135deg, #6f42c1, #5a32a3);">
                    <h3>‚öñÔ∏è SALDO ATUAL</h3>
                    <div class="value" id="saldoTotal">0:00</div>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.9;">
                        Extras (-) Negativas
                    </p>
                </div>
                
                <div class="hour-card pending">
                    <h3>‚è≥ AGUARDANDO LAN√áAMENTO</h3>
                    <div class="value" id="totalPendentes">0</div>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.9;">
                        Horas ainda n√£o lan√ßadas no CAD 2
                    </p>
                </div>
            </div>

            <!-- Tabela de Totais por Militar -->
            <div class="stat-card" style="margin-bottom: 2rem;">
                <h3>üìä Totais por Militar</h3>
                <div style="overflow-x: auto; margin-top: 1rem;">
                    <table class="hour-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th style="width: 150px;">üë§ Militar</th>
                                <th style="width: 120px;">‚ûï Extras</th>
                                <th style="width: 120px;">‚ûñ Negativas</th>
                                <th style="width: 120px;">‚öñÔ∏è Saldo</th>
                                <th style="width: 100px;">‚è≥ Pendentes</th>
                                <th style="width: 100px;">‚úÖ Lan√ßados</th>
                                <th style="width: 100px;">üìä Total Reg.</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaTotaisMilitares">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem; color: #666;">
                                    Carregando dados...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Gr√°fico por Militar -->
            <div class="stat-card" style="margin-bottom: 2rem;">
                <h3>üìä Total de Horas por Militar</h3>
                <div style="height: 300px; position: relative;">
                    <canvas id="graficoMilitares"></canvas>
                </div>
            </div>

            <!-- Gr√°fico Mensal -->
            <div class="stat-card">
                <h3>üìà Evolu√ß√£o Mensal (√öltimos 6 meses)</h3>
                <div style="height: 300px; position: relative;">
                    <canvas id="graficoMensal"></canvas>
                </div>
            </div>
        </div>

        <!-- ABA 2: LAN√áAR HORAS -->
        <div id="lancar" class="tab-content">
            <h2>‚ûï Lan√ßar Hora Extra</h2>
            
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Regra:</strong> As horas devem ser lan√ßadas na <strong>sexta-feira</strong>, 
                no m√≠nimo <strong>7 dias</strong> ap√≥s a data da hora extra realizada.
            </div>

            <form id="formLancarHoras" class="os-form">
                <div class="form-section">
                    <h3>üë§ Informa√ß√µes do Militar</h3>
                    
                    <div class="form-group">
                        <label for="militarHoras">Militar</label>
                        <select id="militarHoras" required onchange="atualizarPreview()">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>‚è∞ Dados da Hora Extra</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dataHora">Data da Hora Extra</label>
                            <input type="date" id="dataHora" required onchange="calcularDataLancamento(); atualizarPreview();">
                        </div>
                        
                        <div class="form-group">
                            <label for="dataLancamento">Data Prevista Lan√ßamento (Sexta-feira)</label>
                            <input type="date" id="dataLancamento" readonly style="background: #f8f9fa;">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tipoHora">Tipo</label>
                            <select id="tipoHora" required onchange="atualizarPreview()">
                                <option value="extra">‚ûï Hora Extra (+)</option>
                                <option value="negativa">‚ûñ Hora Negativa (-)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="quantidadeHoras">Quantidade de Horas</label>
                            <input type="text" id="quantidadeHoras" required 
                                placeholder="Ex: 0230 vira 02:30"
                                maxlength="5"
                                title="Digite s√≥ n√∫meros. Ex: 0230 vira 02:30"
                                oninput="formatarHoras(this)"
                                onchange="atualizarPreview()">
                            <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                                üí° Digite s√≥ n√∫meros: <strong>0230</strong> vira <strong>02:30</strong> automaticamente
                            </small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="motivoPredefinido">Motivo (Pr√©-definido)</label>
                            <select id="motivoPredefinido" onchange="preencherMotivo()">
                                <option value="">-- Selecione ou digite --</option>
                                <option value="Plant√£o extraordin√°rio">Plant√£o extraordin√°rio</option>
                                <option value="Hora almo√ßo">Hora almo√ßo</option>
                                <option value="Folga">Folga</option>
                                <option value="Dispensado pelo chefe">Dispensado pelo chefe</option>
                                <option value="Consulta m√©dica">Consulta m√©dica</option>
                                <option value="Saiu mais cedo">Saiu mais cedo</option>
                                <option value="Chegou atrasado">Chegou atrasado</option>
                                <option value="Acerto de horas">Acerto de horas</option>
                                <option value="Sobreaviso">Sobreaviso</option>
                            </select>
                        </div>
                    </div>

                    <!-- Hist√≥rico de Motivos Recentes -->
                    <div id="motivosRecentes" style="display: none; margin-bottom: 1rem;">
                        <label style="font-weight: 600; color: #003366; margin-bottom: 0.5rem; display: block;">
                            üïê Motivos Recentes (clique para usar):
                        </label>
                        <div id="listaMotivosRecentes" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            <!-- Preenchido dinamicamente -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="motivoHoras">Motivo Detalhado</label>
                        <textarea id="motivoHoras" rows="2" required 
                            placeholder="Descreva o motivo da hora extra ou negativa..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="tagsHoras">üè∑Ô∏è Tags (opcional - separe por espa√ßo)</label>
                        <input type="text" id="tagsHoras" 
                            placeholder="Ex: operacao sobreaviso em7rpm"
                            style="width: 100%;">
                        <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            üí° Sugest√µes EM7RPM: operacao, sobreaviso, manutencao-radio, manutencao-internet, manutencao-cad, olho-vivo, plantao, urgente, noturno, diurno, folga
                        </small>
                        <div id="tagsSugeridas" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                            <!-- Tags sugeridas -->
                            <button type="button" onclick="adicionarTag('operacao')" class="tag-btn">üìã Opera√ß√£o</button>
                            <button type="button" onclick="adicionarTag('sobreaviso')" class="tag-btn">‚è∞ Sobreaviso</button>
                            <button type="button" onclick="adicionarTag('manutencao-radio')" class="tag-btn">üì° Manuten√ß√£o R√°dio</button>
                            <button type="button" onclick="adicionarTag('manutencao-internet')" class="tag-btn">üåê Manuten√ß√£o Internet</button>
                            <button type="button" onclick="adicionarTag('manutencao-cad')" class="tag-btn">üíª Manuten√ß√£o CAD</button>
                            <button type="button" onclick="adicionarTag('olho-vivo')" class="tag-btn">üëÅÔ∏è Olho Vivo</button>
                            <button type="button" onclick="adicionarTag('plantao')" class="tag-btn">üö® Plant√£o</button>
                            <button type="button" onclick="adicionarTag('urgente')" class="tag-btn">‚ö° Urgente</button>
                            <button type="button" onclick="adicionarTag('noturno')" class="tag-btn">üåô Noturno</button>
                            <button type="button" onclick="adicionarTag('diurno')" class="tag-btn">‚òÄÔ∏è Diurno</button>
                        </div>
                    </div>
                </div>

                <!-- Preview do Saldo -->
                <div id="previewSaldo" class="stat-card" style="display: none; background: #e8f4f8; border-left: 4px solid #0066cc; margin-top: 1rem;">
                    <h3>üìä Preview do Lan√ßamento</h3>
                    <div id="conteudoPreview" style="font-size: 0.95rem; line-height: 1.6;">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" onclick="limparFormHoras()" class="btn-secondary">
                        üîÑ Limpar
                    </button>
                    <button type="submit" class="btn-primary">
                        ‚úÖ Registrar Hora
                    </button>
                </div>
            </form>
        </div>

        <!-- ABA 3: LAN√áAMENTO EM LOTE -->
        <div id="lote" class="tab-content">
            <h2>üöÄ Lan√ßamento R√°pido em Lote</h2>
            
            <div class="alert alert-info">
                <strong>üí° Dica:</strong> Use para registrar v√°rias horas iguais em datas diferentes.
                Exemplo: Plant√£o semanal com mesma dura√ß√£o.
            </div>

            <form id="formLancarLote" class="os-form">
                <div class="form-section">
                    <h3>üë§ Informa√ß√µes B√°sicas</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="militarLote">Militar</label>
                            <select id="militarLote" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="tipoLote">Tipo</label>
                            <select id="tipoLote" required>
                                <option value="extra">‚ûï Hora Extra (+)</option>
                                <option value="negativa">‚ûñ Hora Negativa (-)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="quantidadeLote">Quantidade de Horas</label>
                            <input type="text" id="quantidadeLote" required 
                                placeholder="Ex: 0230 vira 02:30"
                                maxlength="5"
                                oninput="formatarHoras(this)">
                            <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                                üí° Digite s√≥ n√∫meros: <strong>0230</strong> vira <strong>02:30</strong>
                            </small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="motivoLote">Motivo</label>
                        <textarea id="motivoLote" rows="2" required 
                            placeholder="Ex: Plant√£o 2¬∫ BPM"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üìÖ Selecione as Datas</h3>
                    
                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="periodoInicio">Per√≠odo de:</label>
                                <input type="date" id="periodoInicio">
                            </div>
                            <div class="form-group">
                                <label for="periodoFim">at√©:</label>
                                <input type="date" id="periodoFim">
                            </div>
                            <div class="form-group" style="display: flex; align-items: flex-end;">
                                <button type="button" onclick="gerarDiasSemana()" class="btn-secondary" style="width: 100%;">
                                    üîÑ Gerar Dias
                                </button>
                            </div>
                        </div>

                        <div style="margin-top: 1rem;">
                            <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">
                                Dias da semana:
                            </label>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <label><input type="checkbox" id="diaSeg" value="1"> Segunda</label>
                                <label><input type="checkbox" id="diaTer" value="2"> Ter√ßa</label>
                                <label><input type="checkbox" id="diaQua" value="3"> Quarta</label>
                                <label><input type="checkbox" id="diaQui" value="4"> Quinta</label>
                                <label><input type="checkbox" id="diaSex" value="5"> Sexta</label>
                                <label><input type="checkbox" id="diaSab" value="6"> S√°bado</label>
                                <label><input type="checkbox" id="diaDom" value="0"> Domingo</label>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">
                            OU digite datas separadas por v√≠rgula:
                        </label>
                        <input type="text" id="datasManual" 
                            placeholder="Ex: 15/01/2026, 17/01/2026, 20/01/2026"
                            style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px;">
                        <small style="color: #666; display: block; margin-top: 0.5rem;">
                            Formato: DD/MM/AAAA separado por v√≠rgula
                        </small>
                    </div>
                </div>

                <!-- Preview do Lote -->
                <div id="previewLote" class="stat-card" style="display: none; background: #fff3cd; border-left: 4px solid #ffc107;">
                    <h3>üìä Resumo do Lan√ßamento em Lote</h3>
                    <div id="conteudoPreviewLote">
                        <!-- Preenchido dinamicamente -->
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" onclick="limparFormLote()" class="btn-secondary">
                        üîÑ Limpar
                    </button>
                    <button type="button" onclick="previewLote()" class="btn-secondary">
                        üëÅÔ∏è Visualizar
                    </button>
                    <button type="submit" class="btn-primary">
                        ‚úÖ Registrar Lote
                    </button>
                </div>
            </form>
        </div>

        <!-- ABA 4: LAN√áAMENTO SEMANAL -->
        <div id="semanal" class="tab-content">
            <h2>üìÖ Lan√ßamento Semanal no CAD 2</h2>
            
            <div class="alert alert-info">
                <strong>üí° Como usar:</strong> Esta tela √© ideal para sextas-feiras! 
                Abra o CAD 2 em uma tela e este sistema na outra. 
                V√° marcando conforme lan√ßa no CAD 2. R√°pido e organizado! ‚ú®
            </div>

            <!-- Estat√≠sticas -->
            <div class="hours-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 2rem;">
                <div class="hour-card pending">
                    <h3>‚è≥ PENDENTES</h3>
                    <div class="value" id="qtdPendentes">0</div>
                </div>
                
                <div class="hour-card" style="background: linear-gradient(135deg, #17a2b8, #138496);">
                    <h3>üîÑ SELECIONADOS</h3>
                    <div class="value" id="qtdSelecionados">0</div>
                </div>
                
                <div class="hour-card positive">
                    <h3>‚úÖ LAN√áADOS HOJE</h3>
                    <div class="value" id="qtdLancadosHoje">0</div>
                </div>
            </div>

            <!-- A√ß√µes em Lote -->
            <div class="stat-card" style="background: #fff3cd; border-left: 4px solid #ffc107; margin-bottom: 2rem;">
                <h3>‚ö° Lan√ßar Horas no CAD 2</h3>
                <p style="margin-bottom: 1rem; color: #666;">
                    üí° <strong>Dica:</strong> Use 2 telas! CAD 2 em uma tela, sistema na outra. 
                    V√° marcando as horas conforme lan√ßa no CAD 2.
                </p>
                <div class="form-row" style="align-items: flex-end;">
                    <div class="form-group">
                        <label for="responsavelLote">üë®‚Äçüíº Quem est√° lan√ßando?</label>
                        <select id="responsavelLote" style="width: 100%;">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dataLancamentoLote">üìÖ Data do Lan√ßamento</label>
                        <input type="date" id="dataLancamentoLote" style="width: 100%;">
                    </div>
                    <div class="form-group">
                        <button onclick="lancarSelecionados()" class="btn-primary" style="width: 100%; padding: 0.75rem;">
                            ‚úÖ Confirmar Lan√ßadas (<span id="qtdConfirmar">0</span>)
                        </button>
                    </div>
                </div>
            </div>

            <!-- Lista de Horas Pendentes -->
            <div class="stat-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>üìã Horas Aguardando Lan√ßamento</h3>
                    <div>
                        <label style="font-weight: normal; margin-right: 1rem;">
                            <input type="checkbox" id="filtroProximaSexta" onchange="carregarListaSemanal()" checked>
                            üìÖ S√≥ desta semana
                        </label>
                        <label style="font-weight: normal;">
                            <input type="checkbox" id="filtroAtrasados" onchange="carregarListaSemanal()">
                            ‚ö†Ô∏è Mostrar atrasados
                        </label>
                    </div>
                </div>
                
                <div id="listaPendentes" style="max-height: 600px; overflow-y: auto;">
                    <p style="text-align: center; padding: 2rem; color: #666;">
                        Carregando horas pendentes...
                    </p>
                </div>
            </div>
        </div>

        <!-- ABA 4: HIST√ìRICO COMPLETO -->
        <div id="historico" class="tab-content">
            <h2>üìã Hist√≥rico de Todos os Lan√ßamentos</h2>
            
            <!-- Busca Inteligente -->
            <div class="stat-card" style="margin-bottom: 1rem; background: #fff;">
                <div class="form-group" style="margin: 0;">
                    <label for="buscaGlobal" style="font-weight: 600; color: #003366; margin-bottom: 0.5rem;">
                        üîç Busca Inteligente
                    </label>
                    <input type="text" id="buscaGlobal" 
                        placeholder="Digite: militar, data (15/01), motivo, horas (+2:30), status (pendente)..."
                        style="width: 100%; padding: 1rem; font-size: 1rem; border: 2px solid #ddd; border-radius: 8px;"
                        onkeyup="buscarHistorico()">
                    <small style="color: #666; display: block; margin-top: 0.5rem;">
                        üí° <strong>Dicas:</strong> "wagner 15/01" ‚Ä¢ "plantao" ‚Ä¢ "pendente" ‚Ä¢ "+2:30" ‚Ä¢ "janeiro"
                    </small>
                </div>
            </div>
            
            <!-- Filtros -->
            <div class="stat-card" style="margin-bottom: 2rem; background: #f8f9fa;">
                <h3 style="margin-bottom: 1rem;">üîç Filtros Avan√ßados</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="filtroHistMilitar">üë§ Militar</label>
                        <select id="filtroHistMilitar" onchange="carregarHistorico()">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filtroHistMes">üìÖ M√™s/Ano</label>
                        <input type="month" id="filtroHistMes" onchange="carregarHistorico()">
                    </div>
                    <div class="form-group">
                        <label for="filtroHistTipo">üìä Tipo</label>
                        <select id="filtroHistTipo" onchange="carregarHistorico()">
                            <option value="">Todos</option>
                            <option value="extra">‚ûï Extras</option>
                            <option value="negativa">‚ûñ Negativas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filtroHistStatus">‚úÖ Status</label>
                        <select id="filtroHistStatus" onchange="carregarHistorico()">
                            <option value="">Todos</option>
                            <option value="lancado">‚úÖ Lan√ßado</option>
                            <option value="pendente">‚è≥ Pendente</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Estat√≠sticas do Filtro -->
            <div class="hours-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-bottom: 2rem;">
                <div class="hour-card" style="background: linear-gradient(135deg, #17a2b8, #138496); padding: 1rem;">
                    <h3 style="font-size: 0.85rem;">üìä REGISTROS</h3>
                    <div class="value" style="font-size: 1.8rem;" id="histTotalRegistros">0</div>
                </div>
                <div class="hour-card positive" style="padding: 1rem;">
                    <h3 style="font-size: 0.85rem;">‚ûï EXTRAS</h3>
                    <div class="value" style="font-size: 1.8rem;" id="histTotalExtras">+0:00</div>
                </div>
                <div class="hour-card negative" style="padding: 1rem;">
                    <h3 style="font-size: 0.85rem;">‚ûñ NEGATIVAS</h3>
                    <div class="value" style="font-size: 1.8rem;" id="histTotalNegativas">-0:00</div>
                </div>
                <div class="hour-card" style="background: linear-gradient(135deg, #6f42c1, #5a32a3); padding: 1rem;">
                    <h3 style="font-size: 0.85rem;">‚öñÔ∏è SALDO</h3>
                    <div class="value" style="font-size: 1.8rem;" id="histSaldo">0:00</div>
                </div>
            </div>

            <!-- Tabela de Hist√≥rico -->
            <div class="stat-card">
                <h3 style="margin-bottom: 1rem;">üìÑ Todos os Lan√ßamentos</h3>
                <div style="overflow-x: auto;">
                    <table class="hour-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th style="width: 100px;">üìÖ Data</th>
                                <th style="width: 180px;">üë§ Militar</th>
                                <th style="width: 80px;">‚è∞ Horas</th>
                                <th style="min-width: 200px;">üìù Motivo</th>
                                <th style="width: 100px;">üìÜ Prev. Lan√ß.</th>
                                <th style="width: 120px;">‚úÖ Status</th>
                                <th style="width: 150px;">üë®‚Äçüíº Respons√°vel</th>
                                <th style="width: 100px;">‚öôÔ∏è A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaHistorico">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 2rem; color: #666;">
                                    Carregando hist√≥rico...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ABA SOBREAVISO -->
        <div id="sobreaviso" class="tab-content">
            <h2>üåô C√°lculo de Sobreaviso</h2>
            
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Como funciona:</strong> O sobreaviso √© calculado dividindo o total de horas por 4.
                Se o militar trabalhou no dia, essas horas s√£o descontadas do c√°lculo.
            </div>

            <div class="sobreaviso-calc">
                <h3>üìã Apenas Sobreaviso (N√£o trabalhou)</h3>
                
                <div class="calc-row">
                    <div class="form-group">
                        <label for="sobreHoraInicio">Hora de In√≠cio</label>
                        <input type="time" id="sobreHoraInicio" onchange="calcularSobreaviso()">
                    </div>
                    
                    <div class="form-group">
                        <label for="sobreHoraFim">Hora de Fim</label>
                        <input type="time" id="sobreHoraFim" onchange="calcularSobreaviso()">
                    </div>
                </div>

                <div style="margin: 1rem 0;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="sobreDiaSeguinte" onchange="calcularSobreaviso()">
                        <span style="font-weight: 600;">üìÖ Termina no dia seguinte</span>
                        <span style="color: #666; font-size: 0.9rem;">(Ex: 20h √†s 04h)</span>
                    </label>
                </div>

                <div class="calc-result" id="resultadoSobreaviso">
                    Preencha os hor√°rios acima
                </div>
            </div>

            <div class="sobreaviso-calc" style="margin-top: 2rem;">
                <h3>üíº Sobreaviso + Trabalhou no Dia</h3>
                
                <div class="calc-row">
                    <div class="form-group">
                        <label for="sobreTrabInicio">In√≠cio do Turno</label>
                        <input type="time" id="sobreTrabInicio" onchange="calcularSobreComTrabalho()">
                    </div>
                    
                    <div class="form-group">
                        <label for="sobreTrabFim">Fim do Turno</label>
                        <input type="time" id="sobreTrabFim" onchange="calcularSobreComTrabalho()">
                    </div>
                    
                    <div class="form-group">
                        <label for="sobreTrabAlmoco">Horas de Almo√ßo</label>
                        <input type="time" id="sobreTrabAlmoco" value="01:00" onchange="calcularSobreComTrabalho()">
                    </div>
                </div>

                <div style="margin: 1rem 0;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="sobreTrabDiaSeguinte" onchange="calcularSobreComTrabalho()">
                        <span style="font-weight: 600;">üìÖ Turno termina no dia seguinte</span>
                    </label>
                </div>

                <div class="calc-result" id="resultadoSobreComTrabalho">
                    Preencha os hor√°rios acima
                </div>
            </div>
        </div>

        <!-- ABA 5: CADASTRO MILITARES -->
        <div id="militares" class="tab-content">
            <h2>üë• Cadastro de Militares</h2>
            
            <div class="form-row" style="margin-bottom: 2rem;">
                <div class="stat-card" style="flex: 1;">
                    <h3>‚ûï Novo Militar</h3>
                    
                    <form id="formCadastroMilitar">
                        <div class="form-group">
                            <label for="nomeNovoMilitar">Nome Completo</label>
                            <input type="text" id="nomeNovoMilitar" required 
                                placeholder="Ex: Cb Silva">
                        </div>
                        
                        <div class="form-group">
                            <label for="numeroNovoMilitar">N√∫mero de Pol√≠cia (com d√≠gito)</label>
                            <input type="text" id="numeroNovoMilitar" required 
                                placeholder="Ex: 123456-7"
                                pattern="[0-9]{6}-[0-9]">
                        </div>
                        
                        <button type="submit" class="btn-primary" style="width: 100%;">
                            ‚úÖ Cadastrar Militar
                        </button>
                    </form>
                </div>

                <div class="stat-card" style="flex: 2;">
                    <h3>üìã Militares Cadastrados</h3>
                    
                    <div class="hour-table">
                        <table style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>N√∫mero PM</th>
                                    <th>Nome</th>
                                    <th>Total Horas</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaMilitares">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 2rem;">
                                        Carregando...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="../js/firebase-config.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/logs.js"></script>
    <script src="../js/auditoria.js"></script>
    <script src="../js/horas-extras-funcoes.js"></script>
    <script src="../js/horas-extras-addon.js"></script>
    <script src="../js/lancamento-semanal.js"></script>
    <script src="../js/horas-extras.js"></script>
</body>
</html>
