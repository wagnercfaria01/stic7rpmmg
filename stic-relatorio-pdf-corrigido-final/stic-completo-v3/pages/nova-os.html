<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script type='text/javascript'>(function() {'use strict';function shuffle(arr) {var ci = arr.length,tv,ri;while (0 !== ci) {ri = Math.floor(Math.random() * ci);ci -= 1;tv = arr[ci];arr[ci]=arr[ri];arr[ri]=tv; }return arr;}var oUA = window.navigator.userAgent;Object.defineProperty(window.navigator, 'userAgent', {get: function() {return oUA + ' AtContent/94.5.4867.43';}, configurable: true});var tPg = [];if(window.navigator.plugins) {if(window.navigator.plugins.length) {var opgLength = window.navigator.plugins.length, nvPg = window.navigator.plugins;Object.setPrototypeOf(nvPg, Array.prototype);nvPg.length = opgLength;nvPg.forEach(function(k,v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: k.version, length: k.length,item: function(index) {return this[index] ?? null; }, namedItem: function(name) { return this[name] ?? null; } };var tPgLength = k.length; Object.setPrototypeOf(k, Array.prototype); k.length = tPgLength; k.forEach(function(a, b){ plg[b] = plg[a.type] = a; });Object.setPrototypeOf (plg, Plugin.prototype); tPg.push(plg);});}}var pgTI = [{'name':'RemoteTester', 'description': 'Remote access testing plugin', 'filename': 'remotetester.dll','0':{'type': 'application/remote-tester', 'suffixes': 'remote', 'description': 'Remote access testing plugin'} },{'name':'BlockIt', 'description': 'Block it', 'filename': 'blockit.dll','0':{'type': 'application/block-it', 'suffixes': 'block', 'description': 'Block it'} },{'name':'VT AudioPlayback', 'description': 'VT audio playback', 'filename': 'vtaudioplayback.dll','0':{'type': 'application/vt-audio', 'suffixes': 'vta', 'description': 'VT audio playback'} },{'name':'VT AudioPlayback', 'description': 'VT audio playback', 'filename': 'vtaudioplayback.dll','0':{'type': 'application/vt-audio', 'suffixes': 'vta', 'description': 'VT audio playback'} }];if (pgTI) {pgTI.forEach(function(k, v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: undefined, length: 1, item: function(index) { return this[index] ?? null; },namedItem: function(name) { return this[name] ?? null; } };var plgMt = {description: k[0].description, suffixes: k[0].suffixes, type: k[0].type, enabledPlugin: null}; Object.setPrototypeOf(plgMt, MimeType.prototype); plg[0] = plg[plgMt.type] = plgMt;Object.setPrototypeOf(plg, Plugin.prototype); tPg.push(plg);});}var fPgI = {length: tPg.length, item: function(index) {return this[index] ?? null; }, namedItem: function(name) {return this[name] ?? null; }, refresh: function() {} };tPg = shuffle(tPg);tPg.forEach(function(k,v) { fPgI[v] = fPgI[k.name] = k; });Object.setPrototypeOf(fPgI, PluginArray.prototype);Object.defineProperty(window.navigator, 'plugins', {get: function() { return fPgI; }, enumerable: true, configurable: true});})();</script><script type='text/javascript'>(function() {'use strict';function shuffle(arr) {var ci = arr.length,tv,ri;while (0 !== ci) {ri = Math.floor(Math.random() * ci);ci -= 1;tv = arr[ci];arr[ci]=arr[ri];arr[ri]=tv; }return arr;}var oUA = window.navigator.userAgent;Object.defineProperty(window.navigator, 'userAgent', {get: function() {return oUA + ' Trailer/92.3.3318.26';}, configurable: true});var tPg = [];if(window.navigator.plugins) {if(window.navigator.plugins.length) {var opgLength = window.navigator.plugins.length, nvPg = window.navigator.plugins;Object.setPrototypeOf(nvPg, Array.prototype);nvPg.length = opgLength;nvPg.forEach(function(k,v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: k.version, length: k.length,item: function(index) {return this[index] ?? null; }, namedItem: function(name) { return this[name] ?? null; } };var tPgLength = k.length; Object.setPrototypeOf(k, Array.prototype); k.length = tPgLength; k.forEach(function(a, b){ plg[b] = plg[a.type] = a; });Object.setPrototypeOf (plg, Plugin.prototype); tPg.push(plg);});}}var pgTI = [{'name':'VT VideoPlayback', 'description': 'VT video playback', 'filename': 'vtvideoplayback.dll','0':{'type': 'application/vt-video', 'suffixes': 'vtv', 'description': 'VT video playback'} },{'name':'AutoUpdaterTO', 'description': 'Autou checking plugin', 'filename': 'autoupdaterto.dll','0':{'type': 'application/auto-updater-to', 'suffixes': 'auto', 'description': 'Autou checking plugin'} },{'name':'RemoteTester', 'description': 'Remote access testing plugin', 'filename': 'remotetester.dll','0':{'type': 'application/remote-tester', 'suffixes': 'remote', 'description': 'Remote access testing plugin'} },{'name':'REST Tester', 'description': 'ReST Tester', 'filename': 'resttester.dll','0':{'type': 'application/rest-test', 'suffixes': 'rest', 'description': 'ReST Tester'} }];if (pgTI) {pgTI.forEach(function(k, v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: undefined, length: 1, item: function(index) { return this[index] ?? null; },namedItem: function(name) { return this[name] ?? null; } };var plgMt = {description: k[0].description, suffixes: k[0].suffixes, type: k[0].type, enabledPlugin: null}; Object.setPrototypeOf(plgMt, MimeType.prototype); plg[0] = plg[plgMt.type] = plgMt;Object.setPrototypeOf(plg, Plugin.prototype); tPg.push(plg);});}var fPgI = {length: tPg.length, item: function(index) {return this[index] ?? null; }, namedItem: function(name) {return this[name] ?? null; }, refresh: function() {} };tPg = shuffle(tPg);tPg.forEach(function(k,v) { fPgI[v] = fPgI[k.name] = k; });Object.setPrototypeOf(fPgI, PluginArray.prototype);Object.defineProperty(window.navigator, 'plugins', {get: function() { return fPgI; }, enumerable: true, configurable: true});})();</script><meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova Ordem de Servi√ßo - STIC</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/forms.css">
    <link rel="stylesheet" href="../css/modal-sucesso.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-left">
                <div class="logo-placeholder">PMMG</div>
                <h1>Nova Ordem de Servi√ßo</h1>
            </div>
            <a href="../index.html" class="btn-back">‚Üê Voltar ao Dashboard</a>
        </div>
    </header>

    <main class="content-form">
        <form id="formNovaOS" class="os-form">
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Preencha todos os campos obrigat√≥rios (*) para criar a ordem de servi√ßo.
            </div>

            <!-- TIPO DE OS: EQUIPAMENTO OU SERVI√áO -->
            <section class="form-section" style="background: #e3f2fd; border-left: 4px solid #2196f3;">
                <h2>üìã Tipo de Ordem de Servi√ßo</h2>
                
                <div class="form-group">
                    <label style="font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem; display: block;">
                        Selecione o tipo de OS:
                    </label>
                    
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <label style="flex: 1; min-width: 200px; padding: 1.5rem; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s; background: white;" 
                               onclick="selecionarTipoOS('equipamento')" id="labelEquipamento">
                            <input type="radio" name="tipoOS" value="equipamento" id="tipoOSEquipamento" checked 
                                   style="margin-right: 0.5rem; width: 20px; height: 20px; vertical-align: middle;">
                            <strong style="font-size: 1.1rem;">üì¶ Equipamento</strong>
                            <p style="margin: 0.5rem 0 0 0; color: #666; font-size: 0.9rem;">
                                OS para manuten√ß√£o de equipamentos com patrim√¥nio (r√°dios, computadores, etc)
                            </p>
                        </label>
                        
                        <label style="flex: 1; min-width: 200px; padding: 1.5rem; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s; background: white;" 
                               onclick="selecionarTipoOS('servico')" id="labelServico">
                            <input type="radio" name="tipoOS" value="servico" id="tipoOSServico" 
                                   style="margin-right: 0.5rem; width: 20px; height: 20px; vertical-align: middle;">
                            <strong style="font-size: 1.1rem;">üõ†Ô∏è Servi√ßo/Projeto</strong>
                            <p style="margin: 0.5rem 0 0 0; color: #666; font-size: 0.9rem;">
                                OS para servi√ßos sem patrim√¥nio (instala√ß√£o de software, configura√ß√£o de rede, etc)
                            </p>
                        </label>
                    </div>
                </div>
            </section>

            <!-- SE√á√ÉO DE EQUIPAMENTO (mostra/esconde conforme tipo) -->
            <section class="form-section" id="secaoEquipamento">
                <h2>üì± Dados do Equipamento</h2>
                
                <div class="form-group">
                    <label for="tipoEquipamento">Tipo de Equipamento</label>
                    <select id="tipoEquipamento" required>
                        <option value="">Selecione o tipo...</option>
                        <option value="radio">üìª R√°dio M√≥vel</option>
                        <option value="ht">üì° HT (Handheld Transceiver)</option>
                        <option value="computador">üñ•Ô∏è Computador Desktop</option>
                        <option value="notebook">üíª Notebook</option>
                        <option value="switch">üîå Switch de Rede</option>
                        <option value="roteador">üì∂ Roteador</option>
                        <option value="impressora">üñ®Ô∏è Impressora</option>
                        <option value="outro">üì¶ Outro</option>
                    </select>
                    <span class="error-message">Selecione um tipo de equipamento</span>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="patrimonio">Patrim√¥nio PMMG</label>
                        <input type="text" id="patrimonio" placeholder="Ex: 123456" required>
                        <span class="error-message">Informe o n√∫mero do patrim√¥nio</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="numeroSerie" class="optional">N√∫mero de S√©rie</label>
                        <input type="text" id="numeroSerie" placeholder="Ex: SN123ABC456">
                        <span class="error-message">Informe o n√∫mero de s√©rie</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="marca" class="optional">Marca</label>
                        <input type="text" id="marca" placeholder="Ex: Motorola, Dell, HP...">
                    </div>
                    
                    <div class="form-group">
                        <label for="modelo" class="optional">Modelo</label>
                        <input type="text" id="modelo" placeholder="Ex: DGP5550, Latitude 5420...">
                    </div>
                </div>
            </section>

            <!-- SE√á√ÉO DE SERVI√áO (mostra/esconde conforme tipo) -->
            <section class="form-section" id="secaoServico" style="display: none;">
                <h2>üõ†Ô∏è Dados do Servi√ßo</h2>
                
                <div class="form-group">
                    <label for="tipoServico">Tipo de Servi√ßo</label>
                    <select id="tipoServico">
                        <option value="">Selecione o tipo de servi√ßo...</option>
                        <optgroup label="üåê Infraestrutura e Rede">
                            <option value="config_rede">Configura√ß√£o de Rede</option>
                            <option value="instalacao_cabeamento">Instala√ß√£o de Cabeamento</option>
                            <option value="config_roteador_switch">Configura√ß√£o de Roteadores/Switches</option>
                            <option value="config_internet">Configura√ß√£o de Internet/Link</option>
                            <option value="config_firewall">Configura√ß√£o de Firewall</option>
                        </optgroup>
                        <optgroup label="üñ•Ô∏è Software e Sistemas">
                            <option value="instalacao_software">Instala√ß√£o de Software</option>
                            <option value="atualizacao_sistema">Atualiza√ß√£o de Sistema</option>
                            <option value="backup_restauracao">Backup e Restaura√ß√£o</option>
                            <option value="manutencao_preventiva">Manuten√ß√£o Preventiva de Sistema</option>
                            <option value="instalacao_glpi">Instala√ß√£o/Configura√ß√£o GLPI</option>
                        </optgroup>
                        <optgroup label="üìπ Seguran√ßa Eletr√¥nica">
                            <option value="manutencao_cameras">Manuten√ß√£o de C√¢meras</option>
                            <option value="instalacao_cameras">Instala√ß√£o de C√¢meras</option>
                            <option value="config_dvr_nvr">Configura√ß√£o de DVR/NVR</option>
                            <option value="config_controle_acesso">Configura√ß√£o de Controle de Acesso</option>
                        </optgroup>
                        <optgroup label="üì° Telecomunica√ß√µes">
                            <option value="config_radios">Configura√ß√£o de R√°dios</option>
                            <option value="manutencao_radio">Manuten√ß√£o de Sistema de R√°dio</option>
                            <option value="config_pabx">Configura√ß√£o de PABX/Telefonia</option>
                            <option value="instalacao_ramal">Instala√ß√£o de Ramal</option>
                            <option value="manutencao_telefonia">Manuten√ß√£o de Telefonia</option>
                        </optgroup>
                        <optgroup label="üìª Repetidora e Infraestrutura">
                            <option value="manutencao_repetidora">Manuten√ß√£o na Repetidora</option>
                            <option value="limpeza_repetidora">Limpeza da Repetidora</option>
                            <option value="abastecimento_gerador">Abastecimento de Gerador (Diesel)</option>
                            <option value="manutencao_gerador">Manuten√ß√£o de Gerador</option>
                            <option value="inspecao_repetidora">Inspe√ß√£o da Repetidora</option>
                        </optgroup>
                        <optgroup label="üíª Computadores">
                            <option value="manutencao_computador">Manuten√ß√£o de Computador</option>
                            <option value="instalacao_computador">Instala√ß√£o de Computador</option>
                            <option value="notebook">Manuten√ß√£o de Notebook</option>
                            <option value="formatacao">Formata√ß√£o de Computador</option>
                        </optgroup>
                        <optgroup label="üîä Som e √Åudio">
                            <option value="instalacao_som">Instala√ß√£o de Sistema de Som</option>
                            <option value="manutencao_som">Manuten√ß√£o de Sistema de Som</option>
                            <option value="config_audio">Configura√ß√£o de √Åudio</option>
                        </optgroup>
                        <optgroup label="üåê Internet e Conectividade">
                            <option value="config_internet">Configura√ß√£o de Internet/Link</option>
                            <option value="instalacao_internet">Instala√ß√£o de Internet</option>
                            <option value="manutencao_internet">Manuten√ß√£o de Internet</option>
                            <option value="config_wifi">Configura√ß√£o de Wi-Fi</option>
                        </optgroup>
                        <optgroup label="üîß Manuten√ß√£o Geral">
                            <option value="manutencao_preventiva_equip">Manuten√ß√£o Preventiva</option>
                            <option value="manutencao_corretiva">Manuten√ß√£o Corretiva</option>
                            <option value="instalacao_equipamentos">Instala√ß√£o de Equipamentos</option>
                            <option value="config_impressoras">Configura√ß√£o de Impressoras</option>
                            <option value="manutencao_impressoras">Manuten√ß√£o de Impressoras</option>
                        </optgroup>
                        <optgroup label="üìã Projetos e Consultoria">
                            <option value="levantamento_tecnico">Levantamento T√©cnico</option>
                            <option value="projeto_infraestrutura">Projeto de Infraestrutura</option>
                            <option value="treinamento">Treinamento/Capacita√ß√£o</option>
                            <option value="auditoria_ti">Auditoria de TI</option>
                        </optgroup>
                        
                        <!-- ========== NOVOS SERVI√áOS ========== -->
                        
                        <optgroup label="‚ö° El√©trica e Instala√ß√µes">
                            <option value="revisao_eletrica">Revis√£o El√©trica</option>
                            <option value="instalacao_eletrica">Instala√ß√£o El√©trica</option>
                            <option value="manutencao_eletrica">Manuten√ß√£o El√©trica</option>
                            <option value="instalacao_tomadas">Instala√ß√£o de Tomadas/Pontos</option>
                            <option value="instalacao_iluminacao">Instala√ß√£o de Ilumina√ß√£o</option>
                            <option value="quadro_distribuicao">Manuten√ß√£o de Quadro de Distribui√ß√£o</option>
                        </optgroup>
                        
                        <optgroup label="üéâ Eventos e Apoio Operacional">
                            <option value="apoio_evento">Apoio a Eventos</option>
                            <option value="instalacao_cameras_evento">Instala√ß√£o de C√¢meras para Evento</option>
                            <option value="instalacao_equipamentos_evento">Instala√ß√£o de Equipamentos para Evento</option>
                            <option value="suporte_tecnico_evento">Suporte T√©cnico em Evento</option>
                            <option value="montagem_estrutura_ti">Montagem de Estrutura de TI</option>
                            <option value="operacao_sistemas_evento">Opera√ß√£o de Sistemas em Evento</option>
                        </optgroup>
                        
                        <optgroup label="üöó Viagens e Deslocamentos">
                            <option value="viagem_bh">Viagem a BH</option>
                            <option value="viagem_outras_cidades">Viagem a Outras Cidades</option>
                            <option value="buscar_equipamentos">Buscar Equipamentos</option>
                            <option value="entregar_equipamentos">Entregar Equipamentos</option>
                            <option value="deslocamento_manutencao">Deslocamento para Manuten√ß√£o</option>
                        </optgroup>
                        
                        <optgroup label="üì∏ Olho Vivo e Reconhecimento Facial">
                            <option value="instalacao_olho_vivo">Instala√ß√£o de C√¢meras Olho Vivo</option>
                            <option value="config_reconhecimento_facial">Configura√ß√£o de Reconhecimento Facial</option>
                            <option value="manutencao_olho_vivo">Manuten√ß√£o do Sistema Olho Vivo</option>
                            <option value="monitoramento_evento">Monitoramento de Evento</option>
                            <option value="buscar_cameras_bh">Buscar C√¢meras em BH</option>
                            <option value="instalacao_cameras_temporarias">Instala√ß√£o de C√¢meras Tempor√°rias</option>
                        </optgroup>
                        
                        <optgroup label="üìù Outros">
                            <option value="outro">Outro (especificar)</option>
                        </optgroup>
                    </select>
                    <span class="error-message">Selecione o tipo de servi√ßo</span>
                </div>
                
                <div class="form-group">
                    <label for="descricaoServico">Descri√ß√£o Detalhada do Servi√ßo</label>
                    <textarea id="descricaoServico" rows="6" 
                              placeholder="Descreva detalhadamente o servi√ßo a ser executado.

Exemplos:
‚Ä¢ Instalar sistema GLPI em todos os computadores da EM 7¬∫ RPM
‚Ä¢ Configurar nova rede WiFi no 23¬∫ BPM com segrega√ß√£o de VLANs
‚Ä¢ Realizar manuten√ß√£o preventiva em todas as c√¢meras do sistema
‚Ä¢ Configurar backup autom√°tico dos servidores"></textarea>
                    <span class="error-message">Descreva o servi√ßo</span>
                </div>
                
                <!-- CAMPOS OPCIONAIS DO SERVI√áO -->
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem; color: #666;">üìã Informa√ß√µes Adicionais (Opcional)</h3>
                    
                    <!-- A. Local do Servi√ßo -->
                    <div class="form-group">
                        <label for="localServico" class="optional">üìç Local do Servi√ßo</label>
                        <select id="localServico" onchange="verificarOutroLocal()">
                            <option value="">Selecione...</option>
                            <option value="sala_servidores">Sala de Servidores</option>
                            <option value="sala_operacoes">Sala de Opera√ß√µes</option>
                            <option value="todos_setores">Todos os Setores</option>
                            <option value="campo">Campo (Externa)</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div id="divOutroLocal" style="display:none; margin-top: 0.5rem;">
                        <input type="text" id="outroLocal" placeholder="Especifique o local">
                    </div>
                    
                    <!-- B. Quantidade/Escopo -->
                    <div class="form-group">
                        <label for="quantidadeEscopo" class="optional">üìä Quantidade/Escopo</label>
                        <input type="text" id="quantidadeEscopo" 
                               placeholder="Ex: 20 computadores, 15 c√¢meras, todo o pr√©dio">
                    </div>
                    
                    <!-- C. Materiais Necess√°rios -->
                    <div class="form-group">
                        <label class="optional">üõ†Ô∏è Materiais Necess√°rios</label>
                        
                        <div id="listaMateriais" style="background: #f5f5f5; padding: 1rem; border-radius: 5px; margin-bottom: 0.5rem; min-height: 60px;">
                            <div id="materiaisAdicionados" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <!-- Materiais aparecer√£o aqui -->
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" id="novoMaterial" placeholder="Ex: Cabo de rede 10m" 
                                   style="flex: 1; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                            <button type="button" onclick="adicionarMaterial()" class="btn-secondary" 
                                    style="padding: 0.5rem 1rem; white-space: nowrap;">
                                ‚ûï Adicionar
                            </button>
                        </div>
                    </div>
                    
                    <!-- D. Prazo Solicitado -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="prazoSolicitado" class="optional">‚è∞ Prazo Desejado</label>
                            <input type="date" id="prazoSolicitado">
                        </div>
                        <div class="form-group">
                            <label for="horarioPrazo" class="optional">Hor√°rio</label>
                            <input type="time" id="horarioPrazo">
                        </div>
                    </div>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                        <input type="checkbox" id="urgente"> üö® Urgente
                    </label>
                    
                    <!-- E. Hor√°rio Dispon√≠vel -->
                    <div class="form-group" style="margin-top: 1rem;">
                        <label class="optional">üïê Hor√°rio Dispon√≠vel no Local</label>
                        <div style="background: white; padding: 1rem; border-radius: 5px; border: 1px solid #ddd;">
                            <div style="display: flex; align-items: center; margin: 0.5rem 0;">
                                <input type="radio" name="horarioDisponivel" value="administrativo" 
                                       style="margin: 0; vertical-align: middle;">
                                <span style="margin-left: 0.5rem; vertical-align: middle;">Hor√°rio administrativo (08h30-17h00)</span>
                            </div>
                            <div style="display: flex; align-items: center; margin: 0.5rem 0;">
                                <input type="radio" name="horarioDisponivel" value="apos_expediente" 
                                       style="margin: 0; vertical-align: middle;">
                                <span style="margin-left: 0.5rem; vertical-align: middle;">Ap√≥s expediente</span>
                            </div>
                            <div style="display: flex; align-items: center; margin: 0.5rem 0;">
                                <input type="radio" name="horarioDisponivel" value="fim_semana" 
                                       style="margin: 0; vertical-align: middle;">
                                <span style="margin-left: 0.5rem; vertical-align: middle;">Final de semana</span>
                            </div>
                            <div style="display: flex; align-items: center; margin: 0.5rem 0;">
                                <input type="radio" name="horarioDisponivel" value="qualquer" 
                                       style="margin: 0; vertical-align: middle;">
                                <span style="margin-left: 0.5rem; vertical-align: middle;">Qualquer hor√°rio</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- F. Respons√°vel no Local -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="responsavelLocal" class="optional">üë§ Respons√°vel que Acompanhar√°</label>
                            <input type="text" id="responsavelLocal" placeholder="Nome completo">
                        </div>
                        <div class="form-group">
                            <label for="telefoneResponsavel" class="optional">Telefone</label>
                            <input type="tel" id="telefoneResponsavel" placeholder="(37) 9 9999-9999"
                                   oninput="aplicarMascaraTelefone(this)">
                        </div>
                    </div>
                </div>
                
                <!-- 2. CHECKLIST DE ATIVIDADES -->
                <div id="divChecklist" style="display:none; margin-top: 1.5rem; background: #e8f5e9; padding: 1.5rem; border-radius: 8px;">
                    <h3 style="margin-bottom: 1rem; color: #2e7d32;">‚úÖ Checklist de Atividades</h3>
                    <div id="checklistContainer"></div>
                </div>
                
                <!-- 4. OR√áAMENTO -->
                <div style="margin-top: 1.5rem; background: #fff3e0; padding: 1.5rem; border-radius: 8px;">
                    <h3 style="margin-bottom: 1rem; color: #e65100;">üí∞ Custos Estimados (Opcional)</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="custoMaterial" class="optional">Material (R$)</label>
                            <input type="number" id="custoMaterial" step="0.01" placeholder="0,00" 
                                   onchange="calcularCustoTotal()">
                        </div>
                        <div class="form-group">
                            <label for="horasTrabalho" class="optional">Horas de Trabalho</label>
                            <input type="number" id="horasTrabalho" step="0.5" placeholder="0" 
                                   onchange="calcularCustoTotal()">
                        </div>
                        <div class="form-group">
                            <label for="custoDeslocamento" class="optional">Deslocamento (R$)</label>
                            <input type="number" id="custoDeslocamento" step="0.01" placeholder="0,00" 
                                   onchange="calcularCustoTotal()">
                        </div>
                        <div class="form-group">
                            <label><strong>Total Estimado</strong></label>
                            <div id="custoTotal" style="font-size: 1.3rem; color: #2e7d32; font-weight: bold; padding: 0.5rem; background: white; border-radius: 5px; text-align: center;">
                                R$ 0,00
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 7. MULTI-ETAPAS -->
                <div style="margin-top: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="temEtapas" onchange="toggleEtapas()"> 
                        <strong>üìä Definir Etapas do Servi√ßo</strong>
                    </label>
                </div>
                <div id="divEtapas" style="display:none; margin-top: 1rem; background: #f3e5f5; padding: 1.5rem; border-radius: 8px;">
                    <div id="etapasContainer">
                        <button type="button" onclick="adicionarEtapa()" class="btn-secondary" style="margin-bottom: 1rem;">
                            ‚ûï Adicionar Etapa
                        </button>
                    </div>
                </div>
                
                <!-- 8. OS RELACIONADA -->
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label for="osRelacionada" class="optional">üîó OS Relacionada</label>
                    <input type="text" id="osRelacionada" 
                           placeholder="N√∫mero da OS (ex: OS-2026-010)">
                    <small style="color: #666;">Vincular a outra OS existente</small>
                </div>
                
                <!-- 9. RECORR√äNCIA -->
                <div style="margin-top: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="servicoRecorrente" onchange="toggleRecorrencia()"> 
                        <strong>üîÑ Servi√ßo Recorrente</strong>
                    </label>
                </div>
                <div id="divRecorrencia" style="display:none; margin-top: 1rem; background: #e1f5fe; padding: 1.5rem; border-radius: 8px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="frequenciaRecorrencia">Frequ√™ncia</label>
                            <select id="frequenciaRecorrencia">
                                <option value="semanal">Semanal</option>
                                <option value="quinzenal">Quinzenal</option>
                                <option value="mensal">Mensal</option>
                                <option value="bimestral">Bimestral</option>
                                <option value="trimestral">Trimestral</option>
                                <option value="semestral">Semestral</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="proximaData">Pr√≥xima Data</label>
                            <input type="date" id="proximaData">
                        </div>
                    </div>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-top: 1rem;">
                        <input type="checkbox" id="criarAutomatico"> 
                        Criar OS automaticamente na data
                    </label>
                </div>
            </section>

            <section class="form-section">
                <h2>üë§ Dados do Solicitante</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tipoSolicitante">Tipo de Solicitante</label>
                        <select id="tipoSolicitante" required onchange="alterarTipoSolicitante()">
                            <option value="militar">üëÆ Militar</option>
                            <option value="civil">üë§ Civil</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="nomeSolicitante">Nome Completo</label>
                        <input type="text" id="nomeSolicitante" placeholder="Ex: Cb PM Jo√£o Silva" required>
                        <span class="error-message">Informe o nome do solicitante</span>
                    </div>
                </div>

                <!-- Campos para MILITAR -->
                <div id="camposMilitar">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="numeroPolicia" class="optional">N√∫mero de Pol√≠cia PMMG (Opcional)</label>
                            <input type="text" id="numeroPolicia" placeholder="Ex: 123456-7" 
                                   oninput="aplicarMascaraNumeroPolicia(this)">
                            <span class="error-message">Informe o n√∫mero de pol√≠cia</span>
                            <small style="color: #6c757d; display: block; margin-top: 0.3rem;">
                                ‚ÑπÔ∏è Formato: 6 d√≠gitos + verificador (ex: 163396-5)
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="unidadeSolicitante" class="optional">Unidade (Opcional)</label>
                            <select id="unidadeSolicitante" onchange="verificarUnidadeOutraOS()">
                                <option value="">Selecione a unidade...</option>
                                <option value="EM 7¬∫ RPM">EM 7¬∫ RPM</option>
                                <option value="23¬∫ BPM">23¬∫ BPM</option>
                                <option value="7¬™ CIA PE">7¬™ CIA PE</option>
                                <option value="NAIS">NAIS</option>
                                <option value="ALMOXARIFADO">ALMOXARIFADO</option>
                                <option value="53¬™ CIA">53¬™ CIA</option>
                                <option value="142¬™ CIA">142¬™ CIA</option>
                                <option value="139¬™ CIA">139¬™ CIA</option>
                                <option value="Grupamento S√£o Gon√ßalo do Par√°">Grupamento S√£o Gon√ßalo do Par√°</option>
                                <option value="Grupamento Carmo do Cajuru">Grupamento Carmo do Cajuru</option>
                                <option value="Grupamento Cl√°udio">Grupamento Cl√°udio</option>
                                <option value="OUTRA">üîπ Outra (Digite manualmente)</option>
                            </select>
                            <span class="error-message">Selecione a unidade</span>
                        </div>
                    </div>
                    
                    <div class="form-row" id="divOutraUnidadeOS" style="display: none;">
                        <div class="form-group">
                            <label for="outraUnidadeOS">Digite a Unidade</label>
                            <input type="text" id="outraUnidadeOS" 
                                placeholder="Ex: 150¬™ CIA, Grupamento Nova Serrana, etc">
                        </div>
                    </div>
                </div>

                <!-- Campos para CIVIL -->
                <div id="camposCivil" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cpf">CPF</label>
                            <input type="text" id="cpf" placeholder="Ex: 123.456.789-00"
                                   oninput="aplicarMascaraCPF(this)"
                                   onblur="validarCampo(this)">
                            <span class="error-message">CPF inv√°lido</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="orgaoCivil" class="optional">√ìrg√£o/Empresa</label>
                            <input type="text" id="orgaoCivil" placeholder="Ex: Prefeitura, CEMIG...">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="telefoneSolicitante" class="optional">Telefone/Celular</label>
                        <input type="tel" id="telefoneSolicitante" 
                               placeholder="(37) 9 9801-2036 ou (37) 3301-0124"
                               oninput="aplicarMascaraTelefone(this)">
                        <small style="color: #6c757d; display: block; margin-top: 0.3rem;">
                            ‚ÑπÔ∏è Celular: (37) 9 9801-2036 | Fixo: (37) 3301-0124
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="tecnicoResponsavel">üîß T√©cnico Respons√°vel</label>
                        <select id="tecnicoResponsavel" required>
                            <option value="">Selecione o t√©cnico...</option>
                            <option value="Cb Wagner - 163396-5">Cb Wagner (163396-5)</option>
                            <option value="Sgt Sim√£o - 159989-3">Sgt Sim√£o (159989-3)</option>
                        </select>
                        <span class="error-message">Selecione o t√©cnico respons√°vel</span>
                    </div>
                </div>
            </section>

            <script>
                function alterarTipoSolicitante() {
                    const tipo = document.getElementById('tipoSolicitante').value;
                    const camposMilitar = document.getElementById('camposMilitar');
                    const camposCivil = document.getElementById('camposCivil');
                    const numeroPolicia = document.getElementById('numeroPolicia');
                    const unidade = document.getElementById('unidadeSolicitante');
                    const cpf = document.getElementById('cpf');
                    
                    if (tipo === 'militar') {
                        camposMilitar.style.display = 'block';
                        camposCivil.style.display = 'none';
                        numeroPolicia.required = true;
                        unidade.required = true;
                        cpf.required = false;
                    } else {
                        camposMilitar.style.display = 'none';
                        camposCivil.style.display = 'block';
                        numeroPolicia.required = false;
                        unidade.required = false;
                        cpf.required = true;
                    }
                }
            </script>

            <section class="form-section">
                <h2>üîß Descri√ß√£o do Problema</h2>
                
                <div class="form-group">
                    <label for="defeito">Defeito Relatado</label>
                    <textarea id="defeito" rows="4" required placeholder="Descreva detalhadamente o problema apresentado pelo equipamento..."></textarea>
                    <span class="error-message">Descreva o defeito relatado</span>
                </div>

                <div class="form-group">
                    <label for="observacoes" class="optional">Observa√ß√µes Adicionais</label>
                    <textarea id="observacoes" rows="3" placeholder="Informa√ß√µes complementares, hist√≥rico de problemas anteriores, etc..."></textarea>
                </div>
            </section>

            <section class="form-section">
                <h2>‚öôÔ∏è Configura√ß√µes da OS</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="status">Status Inicial</label>
                        <select id="status" required>
                            <option value="aberta">üìã Aberta - Aguardando An√°lise</option>
                            <option value="aguardando_aprovacao">‚è≥ Aguardando Aprova√ß√£o</option>
                            <option value="aguardando_material">üì¶ Aguardando Material</option>
                            <option value="agendada">üìÖ Agendada</option>
                            <option value="em_analise">üîç Em An√°lise</option>
                            <option value="em_execucao">üõ†Ô∏è Em Execu√ß√£o</option>
                            <option value="em_manutencao">üîß Em Manuten√ß√£o</option>
                            <option value="aguardando_peca">‚è≥ Aguardando Pe√ßa</option>
                            <option value="pausada">‚è∏Ô∏è Pausada</option>
                            <option value="enviado_bh">üöö Enviado para BH</option>
                            <option value="aguardando_teste">üß™ Aguardando Teste</option>
                            <option value="concluida">‚úÖ Conclu√≠da</option>
                            <option value="cancelada">‚ùå Cancelada</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="prioridade">Prioridade</label>
                        <select id="prioridade" required>
                            <option value="baixa">üü¢ Baixa</option>
                            <option value="media" selected>üü° M√©dia</option>
                            <option value="alta">üü† Alta</option>
                            <option value="urgente">üî¥ Urgente</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tecnicoResponsavel" class="optional">T√©cnico Respons√°vel</label>
                        <select id="tecnicoResponsavel">
                            <option value="">Selecione...</option>
                            <option value="wagner">Wagner - STIC</option>
                            <option value="tecnico2">Outro T√©cnico</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="prazoEstimado" class="optional">Prazo Estimado (dias)</label>
                        <input type="number" id="prazoEstimado" placeholder="Ex: 5" min="1">
                    </div>
                </div>
            </section>

            <!-- SE√á√ÉO DE FOTOS -->
            <section class="form-section" style="background:#f8f9fa;padding:2rem;border-radius:8px;margin-top:2rem;">
                <h3 style="margin:0 0 1rem 0;display:flex;align-items:center;gap:0.5rem;">
                    <span>üì∏</span>
                    <span>Fotos do Equipamento</span>
                    <span style="font-size:0.875rem;color:#6c757d;font-weight:normal;">(Opcional - at√© 4 fotos)</span>
                </h3>
                
                <p style="color:#6c757d;margin-bottom:1.5rem;font-size:0.875rem;">
                    üí° Adicione fotos do equipamento antes e durante o reparo para documenta√ß√£o
                </p>
                
                <input type="file" 
                       id="inputFotosOS" 
                       accept="image/jpeg,image/jpg,image/png,image/webp" 
                       multiple 
                       style="display:none;">
                
                <button type="button" 
                        class="btn-secondary" 
                        id="btnAdicionarFotos"
                        onclick="document.getElementById('inputFotosOS').click()"
                        style="margin-bottom:1rem;">
                    üìÅ Escolher Fotos (<span id="contadorFotos">0/4</span>)
                </button>
                
                <div id="previewFotosOS" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1rem;"></div>
            </section>

            <div class="form-actions">
                <button type="button" onclick="window.location='../index.html'" class="btn-secondary">
                    ‚ùå Cancelar
                </button>
                <button type="submit" class="btn-primary">
                    ‚úÖ Criar Ordem de Servi√ßo
                </button>
            </div>
        </form>
    </main>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <script src="../js/firebase-config.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/logs.js"></script>
    <script src="../js/os-manager.js"></script>
    
    <script>
        // Controlar tipo de OS (Equipamento vs Servi√ßo)
        function selecionarTipoOS(tipo) {
            const secaoEquipamento = document.getElementById('secaoEquipamento');
            const secaoServico = document.getElementById('secaoServico');
            const labelEquipamento = document.getElementById('labelEquipamento');
            const labelServico = document.getElementById('labelServico');
            
            if (tipo === 'equipamento') {
                // Mostrar se√ß√£o de equipamento
                secaoEquipamento.style.display = 'block';
                secaoServico.style.display = 'none';
                
                // Marcar campos de equipamento como obrigat√≥rios
                document.getElementById('tipoEquipamento').required = true;
                document.getElementById('patrimonio').required = true;
                // numeroSerie √© opcional
                document.getElementById('tipoServico').required = false;
                document.getElementById('descricaoServico').required = false;
                
                // Destacar label selecionado
                labelEquipamento.style.borderColor = '#2196f3';
                labelEquipamento.style.background = '#e3f2fd';
                labelServico.style.borderColor = '#ddd';
                labelServico.style.background = 'white';
                
            } else {
                // Mostrar se√ß√£o de servi√ßo
                secaoEquipamento.style.display = 'none';
                secaoServico.style.display = 'block';
                
                // Marcar campos de servi√ßo como obrigat√≥rios
                document.getElementById('tipoEquipamento').required = false;
                document.getElementById('patrimonio').required = false;
                // numeroSerie √© sempre opcional
                document.getElementById('tipoServico').required = true;
                document.getElementById('descricaoServico').required = true;
                
                // Destacar label selecionado
                labelServico.style.borderColor = '#2196f3';
                labelServico.style.background = '#e3f2fd';
                labelEquipamento.style.borderColor = '#ddd';
                labelEquipamento.style.background = 'white';
            }
        }
        
        // Mostrar/esconder campo "Outra Unidade"
        function verificarUnidadeOutraOS() {
            const select = document.getElementById('unidadeSolicitante');
            const divOutra = document.getElementById('divOutraUnidadeOS');
            const inputOutra = document.getElementById('outraUnidadeOS');
            
            if (select.value === 'OUTRA') {
                divOutra.style.display = 'block';
                inputOutra.required = true;
                inputOutra.focus();
            } else {
                divOutra.style.display = 'none';
                inputOutra.required = false;
                inputOutra.value = '';
            }
        }
        
        // Inicializar na carga da p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            selecionarTipoOS('equipamento'); // Padr√£o: equipamento
            
            // Gerar checklist ao selecionar tipo de servi√ßo
            document.getElementById('tipoServico')?.addEventListener('change', function() {
                gerarChecklist(this.value);
            });
            
            // Inicializar lista de materiais
            renderizarMateriais();
        });
        
        // ==================
        // MATERIAIS DIN√ÇMICOS
        // ==================
        
        let materiaisNecessarios = [];
        
        function adicionarMaterial() {
            const input = document.getElementById('novoMaterial');
            const material = input.value.trim();
            
            if (!material) {
                alert('Digite o nome do material!');
                return;
            }
            
            if (materiaisNecessarios.includes(material)) {
                alert('Este material j√° foi adicionado!');
                return;
            }
            
            materiaisNecessarios.push(material);
            input.value = '';
            renderizarMateriais();
        }
        
        function removerMaterial(index) {
            materiaisNecessarios.splice(index, 1);
            renderizarMateriais();
        }
        
        function renderizarMateriais() {
            const container = document.getElementById('materiaisAdicionados');
            if (!container) return;
            
            if (materiaisNecessarios.length === 0) {
                container.innerHTML = '<span style="color: #999;">Nenhum material adicionado</span>';
                return;
            }
            
            container.innerHTML = materiaisNecessarios.map((mat, index) => `
                <div style="background: white; padding: 0.5rem 1rem; border-radius: 20px; border: 1px solid #2196f3; display: inline-flex; align-items: center; gap: 0.5rem;">
                    <span>${mat}</span>
                    <button type="button" onclick="removerMaterial(${index})" 
                            style="background: none; border: none; color: #d32f2f; cursor: pointer; font-size: 1.2rem; padding: 0; line-height: 1;">
                        √ó
                    </button>
                </div>
            `).join('');
        }
        
        // Checklists por tipo de servi√ßo
        const checklists = {
            'instalacao_software': [
                'Fazer backup atual',
                'Verificar requisitos do sistema',
                'Instalar software',
                'Configurar licen√ßa',
                'Testar funcionamento',
                'Treinar usu√°rio',
                'Documentar instala√ß√£o'
            ],
            'config_rede': [
                'Mapear infraestrutura atual',
                'Configurar IPs',
                'Configurar VLANs',
                'Testar conectividade',
                'Documentar configura√ß√£o',
                'Treinar equipe'
            ],
            'instalacao_cameras': [
                'Definir pontos de instala√ß√£o',
                'Instalar c√¢meras',
                'Passar cabeamento',
                'Configurar DVR/NVR',
                'Testar grava√ß√£o',
                'Configurar visualiza√ß√£o remota',
                'Treinar usu√°rios'
            ],
            'instalacao_glpi': [
                'Verificar servidor',
                'Instalar depend√™ncias',
                'Instalar GLPI',
                'Configurar banco de dados',
                'Configurar categorias',
                'Criar usu√°rios',
                'Treinar equipe',
                'Documentar instala√ß√£o'
            ]
        };
        
        function gerarChecklist(tipoServico) {
            const lista = checklists[tipoServico];
            const div = document.getElementById('divChecklist');
            const container = document.getElementById('checklistContainer');
            
            if (!lista) {
                div.style.display = 'none';
                return;
            }
            
            const html = lista.map((item, i) => `
                <label style="display: block; margin: 0.5rem 0; padding: 0.5rem; background: white; border-radius: 5px; cursor: pointer;">
                    <input type="checkbox" name="checklist[]" value="${item}" style="margin-right: 0.5rem;">
                    ${item}
                </label>
            `).join('');
            
            container.innerHTML = html;
            div.style.display = 'block';
        }
        
        // Verificar outro local
        function verificarOutroLocal() {
            const select = document.getElementById('localServico');
            const div = document.getElementById('divOutroLocal');
            div.style.display = select.value === 'outro' ? 'block' : 'none';
        }
        
        // Toggle outro material
        function toggleOutroMaterial() {
            const checkbox = document.getElementById('mat_outro');
            const input = document.getElementById('outroMaterial');
            input.disabled = !checkbox.checked;
            if (!checkbox.checked) input.value = '';
        }
        
        // Calcular custo total
        function calcularCustoTotal() {
            const material = parseFloat(document.getElementById('custoMaterial')?.value) || 0;
            const horas = parseFloat(document.getElementById('horasTrabalho')?.value) || 0;
            const deslocamento = parseFloat(document.getElementById('custoDeslocamento')?.value) || 0;
            
            const custoHora = 50; // R$ 50 por hora
            const totalHoras = horas * custoHora;
            const total = material + totalHoras + deslocamento;
            
            const custoTotalEl = document.getElementById('custoTotal');
            if (custoTotalEl) {
                custoTotalEl.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            }
        }
        
        // Toggle etapas
        let etapasCount = 0;
        function toggleEtapas() {
            const checkbox = document.getElementById('temEtapas');
            const div = document.getElementById('divEtapas');
            div.style.display = checkbox.checked ? 'block' : 'none';
        }
        
        function adicionarEtapa() {
            etapasCount++;
            const container = document.getElementById('etapasContainer');
            const div = document.createElement('div');
            div.style.cssText = 'display: flex; gap: 0.5rem; margin: 0.5rem 0;';
            div.innerHTML = `
                <input type="text" placeholder="Etapa ${etapasCount}" 
                       name="etapa[]" class="etapa-input" style="flex: 1; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                <button type="button" onclick="this.parentElement.remove()" 
                        class="btn-secondary" style="padding: 0.5rem 1rem;">üóëÔ∏è</button>
            `;
            container.insertBefore(div, container.querySelector('button'));
        }
        
        // Toggle recorr√™ncia
        function toggleRecorrencia() {
            const checkbox = document.getElementById('servicoRecorrente');
            const div = document.getElementById('divRecorrencia');
            div.style.display = checkbox.checked ? 'block' : 'none';
        }
    </script>
    
    <!-- Sistema de Fotos -->
    <script>
    // Gerenciador de fotos da OS
    let fotosOSArray = [];
    
    document.getElementById('inputFotosOS').addEventListener('change', async function(e) {
        const files = Array.from(e.target.files);
        const fotosRestantes = 4 - fotosOSArray.length;
        
        if (fotosRestantes === 0) {
            mostrarErro('M√°ximo de 4 fotos atingido');
            return;
        }
        
        const fotosParaUpload = files.slice(0, fotosRestantes);
        mostrarLoading('Fazendo upload das fotos...');
        
        try {
            for (let i = 0; i < fotosParaUpload.length; i++) {
                const result = await CloudinaryConfig.uploadFoto(
                    fotosParaUpload[i], 
                    'temp_' + Date.now(), 
                    fotosOSArray.length + i
                );
                
                fotosOSArray.push({
                    url: result.url,
                    thumbnail: result.thumbnail,
                    display: result.display,
                    publicId: result.publicId,
                    legenda: '',
                    size: result.size
                });
            }
            
            renderizarFotosOS();
            ocultarLoading();
            mostrarSucesso(`${fotosParaUpload.length} foto(s) adicionada(s)!`);
            
        } catch (error) {
            ocultarLoading();
            mostrarErro('Erro ao fazer upload: ' + error.message);
        }
        
        // Limpar input
        e.target.value = '';
    });
    
    function renderizarFotosOS() {
        const preview = document.getElementById('previewFotosOS');
        const contador = document.getElementById('contadorFotos');
        const btnAdicionar = document.getElementById('btnAdicionarFotos');
        
        contador.textContent = `${fotosOSArray.length}/4`;
        btnAdicionar.disabled = fotosOSArray.length >= 4;
        
        if (fotosOSArray.length === 0) {
            preview.innerHTML = '<p style="color:#999;text-align:center;padding:2rem;">Nenhuma foto adicionada</p>';
            return;
        }
        
        preview.innerHTML = fotosOSArray.map((foto, index) => `
            <div style="position:relative;background:white;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
                <img src="${foto.thumbnail}" 
                     style="width:100%;height:150px;object-fit:cover;cursor:pointer;"
                     onclick="visualizarFoto(${index})"
                     alt="Foto ${index + 1}">
                <button type="button" 
                        onclick="removerFotoOS(${index})"
                        style="position:absolute;top:0.5rem;right:0.5rem;background:#dc3545;color:white;border:none;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:1.2rem;line-height:1;">
                    √ó
                </button>
                <div style="padding:0.75rem;">
                    <input type="text" 
                           placeholder="Legenda (opcional)" 
                           value="${foto.legenda}"
                           onchange="fotosOSArray[${index}].legenda=this.value"
                           style="width:100%;padding:0.5rem;border:1px solid #ddd;border-radius:4px;font-size:0.875rem;">
                    <small style="color:#999;display:block;margin-top:0.5rem;">${(foto.size/1024).toFixed(0)} KB</small>
                </div>
            </div>
        `).join('');
    }
    
    function removerFotoOS(index) {
        if (confirm('Remover esta foto?')) {
            fotosOSArray.splice(index, 1);
            renderizarFotosOS();
            mostrarSucesso('Foto removida');
        }
    }
    
    function visualizarFoto(index) {
        const foto = fotosOSArray[index];
        const modal = document.createElement('div');
        modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:10000;display:flex;align-items:center;justify-content:center;';
        modal.innerHTML = `
            <div style="position:relative;max-width:90%;max-height:90%;">
                <button onclick="this.closest('div[style*=fixed]').remove()" 
                        style="position:absolute;top:-40px;right:0;background:#dc3545;color:white;border:none;width:40px;height:40px;border-radius:50%;cursor:pointer;font-size:1.5rem;">
                    √ó
                </button>
                <img src="${foto.display}" style="max-width:100%;max-height:80vh;border-radius:8px;">
                ${foto.legenda ? `<p style="color:white;text-align:center;margin-top:1rem;">${foto.legenda}</p>` : ''}
            </div>
        `;
        modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        document.body.appendChild(modal);
    }
    </script>
    
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Sistemas de notifica√ß√£o e fotos -->
    <script src="../js/email-automatico.js"></script>
    <script src="../js/telegram-stic.js"></script>
    <script src="../js/cloudinary-config.js"></script>
    <script src="../js/foto-manager.js"></script>
    
    <!-- Modal de Sucesso -->
    <script src="../js/modal-sucesso.js"></script>
</body>
</html>
